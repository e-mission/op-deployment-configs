# Configuration files for current OpenPATH deployments

Publishing them on GitHub allows transparency around how they are configured.
This may not be the long-term solution, but it allows us to make progress over the short/medium term.

### Creating a new config

New deployers can file a [templated issue](https://github.com/e-mission/op-deployment-configs/issues/new?assignees=&labels=new+config&projects=&template=add-new-config.yml&title=New+Project+Configuration+-+%5BPROJECT%5D) specifying their configuration. Submitting this will launch an automated workflow that creates a request to add the new config to this repo. Additional steps may be required if they require additional customization of surveys or labels.

Info for partners: [in the docs](https://github.com/e-mission/e-mission-docs/tree/master/docs/use/start_a_project.md)

Info for developers: [in the docs](https://github.com/e-mission/e-mission-docs/tree/master/docs/dev/future/more_custom_auto_config.md)

When your new config submission is accepted and merged, we will set up your environment and send you an email with instructions for logging in to the admin dashboard.

### Reviewing and testing
If you just want to try out the app functionality to see if it would be a good fit for your project, you can:
- Join the open-access environment (https://open-access-openpath.nrel.gov/join),

  -OR-

- Contact us by email at openpath@nlr.gov to receive an OPcode for a `stage` configuration

In general, if you are planning to keep the app installed for less than a day, please use stage so you don't pollute the real dataset.

#### Programs vs. studies

OpenPATH can be used to evaluate travel behavior to evaluate the impact of a specific intervention (e.g. a new transit line, a rebate program that gives people access to e-bikes, etc), or it can be used to collect data on travel behavior without any specific intervention.

In the first case, we typically refer to the deployment as a _study_, while in the second case we typically refer to it as a _program_.

The main functional difference is that a _program_ will have one or more "modes of interest" being evaluated. When a user selects one of these, the app asks the "replaced mode" as a follow-up to understand what the user would have done if the mode of interest had not been available.

#### Pre-generated vs. auto-generated tokens

You have the option to support autogenerated tokens for your deployment, which allows users to log in without needing to get a token from the program admin. This is typically desirable for studies, where the goal is to get as many people as possible to use the app and share their data.
For programs, administrators often need to keep track of who is using the app to monitor participants' progress and provide incentives, so they will use pre-generated tokens and distribute those by email or some other method. If you choose pre-generated tokens, you will be able to generate and download tokens from the admin dashboard once your deployment is set up.

#### Stage study environment

If you are here to preview/review/beta test the app functionality, please use the stage study environment (see instructions above for requesting access)

#### Stage program environment

If you want to experiment with the stage environment for _programs_ please use the stage program environment (see instructions above for requesting access)

If you are here to test out the app on your personal phone, please use the open-access environment (https://open-access-openpath.nrel.gov/join)

In general, if you are planning to keep the app installed for less than a day, please use stage so you don't pollute the real dataset.

### For devlopers

#### Testing local configs on e-mission-phone

As we test more config options, we sometimes need to be able to test local config changes without pushing to GitHub and waiting for a PR to be approved.

To accomplish this:
- Modify one of the existing configs in your local repo or create a new one (e.g. my-deployment.nrel-op.json)
- `docker-compose -f docker-compose.dev.yml up -d` to serve your local configs on localhost:9090
- With an emulator running e-mission-phone, log in with an OPcode for that deployment (e.g. nrelop_my-deployment_1234)
- As long as you are not using a 'production' build of e-mission-phone, the app will check localhost:9090 before it checks GitHub
- You can use "Profile" > "Refresh App Configuration" to quickly test additional changes as long as "version" is incremented in your new version of the config

#### Config options

Example config format (with default values) is:

```
{
    "version": 1,
    "server": {
        "url": "https://openpath-stage.nrel.gov/api/",
        "aggregate_call_auth": "user_only"
    },
    "intro": {
        "program_or_study": "study",
        "program_admin_contact": "K. Shankari",
        "deployment_partner_name": "National Laboratory of the Rockies (NLR)",
        "translated_text": {
            "en": {
                "deployment_name": "Open Access Study",
                "summary_line_1": "enables people to track their travel modes and measure their associated energy use and emissions",
                "summary_line_2": "makes aggregated data on mode shares, trip frequencies, and carbon footprints available via a public dashboard",
                "summary_line_3": "serves as a control group while evaluating behavior change of programs.",
                "short_textual_description": "Transportation is the largest contributor to ...",
                "why_we_collect": "NLR can use this information to ....",
            },
            "es": {
....
            },
            "support_autogen_token": true,
        }
    }
    "display_config": {
        "use_imperial": false,
    },
    "profile_controls": {
        "support_upload": false,
        "trip_end_notification": false
    }
}
```

A TypeScript specification of all the available config options is available in `index.d.ts`.
